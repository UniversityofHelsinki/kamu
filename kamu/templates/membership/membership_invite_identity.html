{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block content %}
  <h1>{% trans "Invite to role" %} {{ role.name }}</h1>
  <div class="alert alert-success" role="alert">
  <p>{% trans "To invite a new member, first check if the identity already exists." %}</p>
  <p>{% trans "You can add a role directly to identities in the Kamu or the organization user directory." %}</p>
  <p>{% trans "If the user is not listed in the directory, you can invite them by email." %}</p>
  </div>
  {% crispy form form.helper %}
  {% if object_list %}
  <h2 id="results-list">{% trans "Kamu results" %}</h2>
  <p>{% trans "To protect user privacy, email addresses and phone numbers are only listed when exactly matching the search parameter." %}</p>
  <table class="table" aria-describedby="results-list">
    <thead>
    <tr>
      <th scope="col">{% trans "Name" %}</th>
      <th scope="col">{% trans "User account" %}</th>
      <th scope="col">{% trans "Email" %}</th>
      <th scope="col">{% trans "Phone" %}</th>
      <th scope="col">{% trans "Select" %}</th>
    </tr>
    </thead>
    <tbody>
    {% for identity in object_list %}
      <tr>
        <th scope="row"><a href="{% url 'identity-detail' identity.pk %}">{{ identity.display_name }}</a></th>
        <td>{% if identity.uid %}{{ identity.uid }}{% endif %}</td>
        <td>{% for address in identity.email_addresses.all %}{% if address.address == email %}{{ address.address }}{% endif %}{% endfor %}</td>
        <td>{% for number in identity.phone_numbers.all %}{% if number.number == phone %}{{ number.number }}{% endif %}{% endfor %}</td>
        <td><a href="{% url 'role-invite-details' role.pk identity.pk %}" class="btn btn-primary mb-3 me-3">{% trans "Add role" %}</a></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% endif %}
  {% if email and not email_found %}
    <h3>{% trans "Email invitation" %}</h3>
    <p>{% trans "Email address not found" %}: {{ email }}</p>
    <a href="{% url 'role-invite-details-email' role.pk %}" class="btn btn-primary mb-3 me-3">{% trans "Send invitation" %}</a>
  {% endif %}
  {% if ldap_results %}
  <h2 id="ldap-results-list" class="mt-4">{% trans "User directory results" %}</h2>
  <table class="table" aria-describedby="ldap-results-list">
    <thead>
    <tr>
      <th scope="col">{% trans "Name" %}</th>
      <th scope="col">{% trans "User account" %}</th>
      <th scope="col">{% trans "Email" %}</th>
      <th scope="col">{% trans "Select" %}</th>
    </tr>
    </thead>
    <tbody>
    {% for result in ldap_results %}
      <tr>
        <th scope="row">{{ result.cn }}</th>
        <td>{{ result.uid }}</td>
        <td>{{ result.mail }}</td>
        <td><a href="{% url 'role-invite-ldap' role.pk result.uid %}" class="btn btn-primary mb-3 me-3">{% trans "Add role" %}</a></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% endif %}
{% endblock %}